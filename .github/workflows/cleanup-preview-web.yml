name: Cleanup Preview Web

on:
  pull_request:
    types: [closed]
    branches:
      - main

jobs:
  delete:
    runs-on: ubuntu-latest
    name: Delete Preview
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Delete Worker
        uses: cloudflare/wrangler-action@v3
        continue-on-error: true
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          command: delete --name viajes-veleta-web-pr-${{ github.event.number }}

      - name: Add Job Summary
        run: |
          echo "## ðŸ—‘ï¸ Preview Cleanup Successful" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "The preview environment for PR #${{ github.event.number }} has been successfully removed from Cloudflare Workers." >> $GITHUB_STEP_SUMMARY
          echo "**Status:** ðŸ›‘ Deleted" >> $GITHUB_STEP_SUMMARY
