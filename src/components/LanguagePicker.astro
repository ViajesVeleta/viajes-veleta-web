---
import { languages } from "../i18n/ui";
import { getLangFromUrl } from "../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const { translatedPaths } = Astro.props;

// Filter out the current language so we only show the switcher for other languages
const otherLanguages = Object.entries(languages).filter(([l]) => l !== lang);
---

<div class="language-picker">
    {
        otherLanguages.map(([l, label]) => {
            let newPath;

            if (translatedPaths && translatedPaths[l]) {
                newPath = translatedPaths[l];
            } else {
                // Determine the new path (very basic: just prepend the lang or swap it)
                const pathname = Astro.url.pathname;
                newPath = pathname;

                // If we are on a localized path, replace the first segment
                const parts = pathname.split("/");
                if (Object.keys(languages).includes(parts[1])) {
                    parts[1] = l === "es" ? "" : l; // 'es' is default, no prefix
                    newPath = parts.join("/").replace("//", "/");
                } else {
                    // We are on the default language (no prefix)
                    newPath = l === "es" ? pathname : `/${l}${pathname}`;
                }
            }

            return (
                <a href={newPath} title={label} class="lang-link">
                    <i class="fa-solid fa-globe" />
                    <span>{l.toUpperCase()}</span>
                </a>
            );
        })
    }
</div>

<style>
    .language-picker {
        display: flex;
        align-items: center;
    }
    .lang-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--on-bg-nav);
        text-decoration: none;
        padding: 0.5rem;
        border-radius: 0.5rem;
        transition: background 0.2s ease;
        font-size: 0.85rem;
        font-weight: 600;
    }
    .lang-link:hover {
        background: color-mix(in srgb, var(--neutral-white), transparent 90%);
    }
    .lang-link span {
        opacity: 0.8;
    }

    [data-main-instance="true"] .lang-link {
        margin-left: 0.5rem;
    }

    @media (max-width: 1100px) {
        .language-picker {
            margin-top: 1rem;
            justify-content: center;
        }
        .lang-link {
            font-size: 1.1rem;
            padding: 0.75rem 1.5rem;
            background: var(--surface-variant);
            border: 1px solid var(--outline-variant);
            border-radius: 50px;
        }
    }
</style>
